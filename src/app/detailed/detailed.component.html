<div class="selector">
  <div class="select">
    <div class="circle orange"></div>
    <select (change)="orangeChange($event)">
      <option *ngFor="let vendorKey of statVendorKeys" [value]="vendorKey" [selected]="vendorKey === orangeSelect">{{resultTypeByKey[vendorKey]}}</option>
    </select>
  </div>
  <div class="select">
    <div class="circle black"></div>
    <select (ngModel)="blackSelect" (change)="blackChange($event)">
      <option *ngFor="let vendorKey of statVendorKeys" [value]="vendorKey" [selected]="vendorKey === blackSelect">{{resultTypeByKey[vendorKey]}}</option>
    </select>
  </div>
</div>
<div *ngFor="let query of (detailedQueries$ | async); let i = index" class="query">
  <div class="header" [id]="query.queryName" [ngClass]="{'highlighted': (anchorQuery$ | async) === query.queryName}">
    <div class="header-box">
      <ng-container *ngIf="!shouldShowRealistic">
        <div class="header-box-number">Q{{i+1}}</div>
        <div class="header-box-name">{{query.queryName}}</div>
      </ng-container>
      <ng-container *ngIf="shouldShowRealistic">
        <div class="header-box-number">W{{i+1}}</div>
      </ng-container>
      <div class="header-box-percentages" *ngIf="!isStatsByVendorIsolated(query.statsByVendor[0])">
        <ng-container *ngFor="let percentage of query.statsByVendor[0].percentages | keyvalue; let last = last">
          <div class="header-box-percentages-item" *ngIf="percentage.value > 0 && percentage.key !== 'numOfQueries' && percentage.key !== 'queryPerc'">
            <div class="header-box-percentages-item-value"><div *ngIf="!shouldShowRealistic"> + </div>{{percentage.value}}%</div>
            <div class="header-box-percentages-item-name"> {{getPercentageName(percentage.key)}} <div *ngIf="!last"> /</div></div>
          </div>
        </ng-container>
      </div>
    </div>
    <div class="header-hash" (click)="anchorQuery(query.queryName)">#</div>
  </div>

  <table>
    <thead>
      <th>
        <div class="cell">
          <div class="cell-title">
            Engine under testing
          </div>
        </div>
      </th>
      <th *ngFor="let vendorKey of statVendorKeys">
        <div class="cell" *ngIf="vendorKey === ResultType.LATENCY && shouldShowLatency">
          <div class="cell-title">
            {{resultTypeByKey[vendorKey]}}
          </div>
          <div class="cell-unit">
            sec
          </div>
        </div>
        <div class="cell" *ngIf="vendorKey === ResultType.THROUGHPUT">
          <div class="cell-title">
            {{resultTypeByKey[vendorKey]}}
          </div>
          <div class="cell-unit">
            Q/s
          </div>
        </div>
        <div class="cell" *ngIf="vendorKey === ResultType.MEMORY">
          <div class="cell-title">
            {{resultTypeByKey[vendorKey]}}
          </div>
          <div class="cell-unit">
            MiB
          </div>
        </div>
      </th>
      <th class="select-header">
      </th>
    </thead>
    <tbody>
      <tr *ngFor="let statByVendor of query.statsByVendor">

        <td>
          <div class="cell">
            <div class="cell-engine">
              {{statByVendor.vendor}}
            </div>
          </div>
        </td>

        <td>
          <div class="cell" [ngStyle]="{'background-color': !statByVendor.memory.isWeakest ? getBackgroundColor(statByVendor.memory.relativeValue) : ''}">
            <div class="cell-data">
              <div class="cell-data-relative" *ngIf="!statByVendor.memory.isWeakest">
                <div class="cell-data-relative-value">
                  × {{statByVendor.memory.relativeValue | number: '1.2-2'}}
                </div>
              </div>
              <div class="cell-data-value" [ngClass]="{'weakest': statByVendor.memory.isWeakest}">
                {{(statByVendor.memory.value / (1024*1024)) | number: '1.3-3'}}
              </div>
            </div>
          </div>
        </td>

        <td>
          <div class="cell" [ngStyle]="{'background-color': !statByVendor.throughput.isWeakest ? getBackgroundColor(statByVendor.throughput.relativeValue) : ''}">
            <div class="cell-data">
              <div class="cell-data-relative" *ngIf="!statByVendor.throughput.isWeakest">
                <div class="cell-data-relative-value">
                  × {{statByVendor.throughput.relativeValue | number: '1.2-2'}}
                </div>
              </div>
              <div class="cell-data-value" [ngClass]="{'weakest': statByVendor.throughput.isWeakest}">
                {{statByVendor.throughput.value | number: '1.3-3'}}
              </div>
            </div>
          </div>
        </td>

        <td *ngIf="shouldShowLatency && isStatsByVendorIsolated(statByVendor)">
          <div class="cell" [ngStyle]="{'background-color': !statByVendor.latency.isWeakest ? getBackgroundColor(statByVendor.latency.relativeValue) : ''}">
            <div class="cell-data">
              <div class="cell-data-relative" *ngIf="!statByVendor.latency.isWeakest">
                <div class="cell-data-relative-value">
                  × {{statByVendor.latency.relativeValue | number: '1.2-2'}}
                </div>
              </div>
              <div class="cell-data-value" [ngClass]="{'weakest': statByVendor.latency.isWeakest}">
                {{statByVendor.latency.value | number: '1.3-3'}}
              </div>
            </div>
          </div>
        </td>

        <td>
          <div class="chart">
            <div class="chart-orange" [ngStyle]="{'width': getOrangeWidth(statByVendor) + '%'}"></div>
            <div class="chart-black" [ngStyle]="{'width': getBlackWidth(statByVendor) + '%'}"></div>
          </div>
        </td>

      </tr>
    </tbody>
  </table>

</div>
